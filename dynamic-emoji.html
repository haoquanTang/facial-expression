<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>动态表情页面</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3), transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.15), transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 119, 198, 0.2), transparent 50%),
                linear-gradient(135deg, #a8b5ff 0%, #6b73ff 25%, #9b59b6 50%, #8e44ad 75%, #6c5ce7 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            cursor: auto;
            transition: background 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .emoji-container {
            position: relative;
            width: 450px;
            height: 450px;
            cursor: auto;
            z-index: 20;
            margin: 0 auto;
        }

        .face {
            width: 100%;
            height: 100%;
            background: linear-gradient(145deg, #ffeb3b 0%, #ffc107 30%, #ff9800 100%);
            border-radius: 50%;
            position: relative;
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.25),
                0 10px 25px rgba(139, 69, 19, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            animation: subtle-pop 0.5s cubic-bezier(0.22, 0.61, 0.36, 1) both;
        }

        .face:hover {
            transform: scale(1.05);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
        }

        /* 面部高光与阴影增强层次感 */
        .face::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: 
                radial-gradient(ellipse at 30% 25%, rgba(255,255,255,0.6) 0%, rgba(255,255,255,0.3) 25%, transparent 45%),
                radial-gradient(ellipse at 70% 25%, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0.15) 20%, transparent 35%);
            pointer-events: none;
        }

        .face::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: 
                radial-gradient(ellipse at 50% 85%, rgba(0,0,0,0.12) 0%, rgba(0,0,0,0.06) 30%, transparent 50%),
                linear-gradient(to bottom, transparent 70%, rgba(0,0,0,0.05) 100%);
            pointer-events: none;
        }

        .eyes {
            position: absolute;
            top: 35%;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 75px;
        }

        .eye {
            width: 90px;
            height: 90px;
            background: radial-gradient(circle at 50% 60%, #ffffff 55%, #eef3f9 72%, #d9e2ec 90%);
            border-radius: 50%;
            position: relative;
            transition: all 0.25s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: inset 0 0 12px rgba(0, 0, 0, 0.18), 0 3px 9px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            will-change: transform;
        }

        /* 顶部轻阴影（眼睑压影） */
        .eye::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, rgba(0,0,0,0.08), transparent 35%);
            pointer-events: none;
        }

        :root {
            /* 虹膜主题颜色（默认蓝色） */
            --iris-c1: #6ec3ff;
            --iris-c2: #328bd7;
            --iris-c3: #0b426f;
            /* 动画速度系数（1为正常，用户可调） */
            --anim-speed: 1;
        }
        
        /* 虹膜主题切换 */
        body[data-iris-theme="blue"] {
            --iris-c1: #6ec3ff;
            --iris-c2: #328bd7;
            --iris-c3: #0b426f;
        }
        
        body[data-iris-theme="green"] {
            --iris-c1: #7dd87d;
            --iris-c2: #4caf50;
            --iris-c3: #2e7d32;
        }
        
        body[data-iris-theme="brown"] {
            --iris-c1: #d4a574;
            --iris-c2: #8d6e63;
            --iris-c3: #5d4037;
        }
        
        body[data-iris-theme="gray"] {
            --iris-c1: #9e9e9e;
            --iris-c2: #616161;
            --iris-c3: #424242;
        }
        
        body[data-iris-theme="purple"] {
            --iris-c1: #ba68c8;
            --iris-c2: #8e24aa;
            --iris-c3: #4a148c;
        }
        
        body[data-iris-theme="amber"] {
            --iris-c1: #ffb74d;
            --iris-c2: #ff9800;
            --iris-c3: #e65100;
        }

        .iris {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 54px;
            height: 54px;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            background: 
                radial-gradient(circle at 30% 30%, #4a4a4a 0%, #2a2a2a 40%, #1a1a1a 70%, #000 100%),
                conic-gradient(from 0deg, #333 0%, #444 25%, #222 50%, #555 75%, #333 100%),
                radial-gradient(circle at 50% 50%, var(--iris-c1) 0%, var(--iris-c2) 56%, var(--iris-c3) 92%);
            box-shadow: 
                inset 0 0 15px rgba(0,0,0,0.26),
                inset 0 0 12px rgba(0,0,0,0.6),
                inset 3px 3px 6px rgba(255,255,255,0.1);
            will-change: transform;
            transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        /* 虹膜纹理细节 */
        .iris::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: 
                radial-gradient(circle at 25% 25%, rgba(255,255,255,0.8) 1px, transparent 2px),
                radial-gradient(circle at 75% 30%, rgba(255,255,255,0.6) 0.5px, transparent 1px),
                radial-gradient(circle at 40% 70%, rgba(255,255,255,0.4) 0.8px, transparent 1.5px),
                conic-gradient(from 45deg, transparent 0%, rgba(255,255,255,0.1) 10%, transparent 20%, rgba(255,255,255,0.05) 30%, transparent 40%);
            z-index: 3;
        }

        /* 眼睛高光反射 */
        .iris::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            background: radial-gradient(circle, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.7) 50%, transparent 100%);
            border-radius: 50%;
            top: 25%;
            left: 30%;
            z-index: 4;
            animation: eye-sparkle 3s ease-in-out infinite;
        }

        /* 若支持 conic-gradient，则增强虹膜纹理与暗环 */
        @supports (background: conic-gradient(from 0deg, red, blue)) {
            .iris {
                background:
                    radial-gradient(circle at 50% 50%, transparent 62%, rgba(0,0,0,0.55) 64%, rgba(0,0,0,0.25) 70%, transparent 72%),
                    radial-gradient(circle at 50% 50%, transparent 0 34%, rgba(255,255,255,0.35) 34% 36%, transparent 36% 100%),
                    conic-gradient(from 0deg, rgba(0,0,0,0.18) 0 6deg, transparent 6deg 12deg),
                    conic-gradient(from 10deg, rgba(0,0,0,0.12) 0 8deg, transparent 8deg 16deg),
                    radial-gradient(circle at 50% 50%, var(--iris-c1) 0%, var(--iris-c2) 56%, var(--iris-c3) 92%);
                box-shadow: inset 0 0 10px rgba(0,0,0,0.35);
            }
        }

        /* 大高光（眼神光），上方椭圆 */
        .iris::after {
            content: '';
            position: absolute;
            top: -6px;
            left: 3px;
            width: 55%;
            height: 40%;
            background: radial-gradient(circle at 30% 35%, rgba(255,255,255,0.8) 0 45%, rgba(255,255,255,0.15) 55%, transparent 70%);
            border-radius: 50%;
            filter: blur(0.6px);
            transform: rotate(-8deg);
        }

        /* 内部小高光（点光） */
        .iris::before {
            content: '';
            position: absolute;
            top: 35%;
            left: 58%;
            width: 12px;
            height: 12px;
            background: rgba(255,255,255,0.9);
            border-radius: 50%;
            box-shadow: 0 0 9px rgba(255,255,255,0.55);
        }

        .pupil {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 21px;
            height: 21px;
            transform: translate(-50%, -50%) scale(var(--pupil-scale, 1));
            border-radius: 50%;
            background: radial-gradient(circle at 50% 50%, #111 0%, #000 70%);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.45);
        }

        /* 高光（眼球反光） */
        .pupil::after {
            content: '';
            position: absolute;
            top: 12%;
            left: 18%;
            width: 9px;
            height: 9px;
            background: rgba(255, 255, 255, 0.85);
            border-radius: 50%;
            filter: blur(0.3px);
        }

        /* 上下眼睑（使用面部颜色覆盖，带睫毛线） */
        .lid {
            position: absolute;
            left: -10%;
            width: 120%;
            height: 60%;
            pointer-events: none;
            border-radius: 60% / 80%;
            transition: transform 220ms ease, box-shadow 220ms ease, background 220ms ease;
            background: linear-gradient(to bottom, rgba(255, 215, 0, 0.95), rgba(255, 215, 0, 0.9));
            will-change: transform;
        }

        .lid.upper {
            top: -35%;
            transform: translateY(-10%);
            border-bottom: 3px solid #000;
        }

        .lid.lower {
            bottom: -35%;
            transform: translateY(10%);
            border-top: 2px solid #000;
        }

        /* 上睫毛细节 */
        .lid.upper::after {
            content: '';
            position: absolute;
            left: 6%;
            right: 6%;
            bottom: -2px;
            height: 6px;
            opacity: 0.25;
            background: repeating-linear-gradient(
                90deg,
                transparent 0 14px,
                rgba(0,0,0,0.6) 14px 15px
            );
        }

        .eyebrow {
            position: absolute;
            width: 75px;
            height: 9px;
            background: #000;
            border-radius: 5px;
            top: 25%;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            will-change: transform, height;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .eyebrow.left {
            left: 20%;
            transform: rotate(-15deg);
            transform-origin: center center;
        }

        .eyebrow.right {
            right: 20%;
            transform: rotate(15deg);
            transform-origin: center center;
        }

        .mouth {
            position: absolute;
            bottom: 22%;
            left: 50%;
            transform: translateX(-50%);
            width: 105px;
            height: 52px;
            border: 5px solid #000;
            border-top: none;
            border-radius: 0 0 105px 105px;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            background: transparent;
            will-change: transform;
        }

        /* 嘴巴状态样式 */
        .mouth.neutral {
            width: 80px;
            height: 28px;
            border-radius: 0 0 80px 80px;
        }

        .mouth.happy {
            width: 135px;
            height: 68px;
            border-radius: 0 0 135px 135px;
            background: linear-gradient(to bottom, rgba(255,192,203,0.3), rgba(255,182,193,0.5));
            animation: mouthPulse 2.5s ease-in-out infinite;
            transform: translateX(-50%) scale(1.05);
            box-shadow: inset 0 -4px 9px rgba(0,0,0,0.1);
            border-width: 6px;
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .mouth.angry {
            width: 68px;
            height: 12px;
            background: #333;
            border-radius: 3px;
            transform: translateX(-50%) rotate(-5deg);
            border: none;
        }

        /* 嘴巴强度变化 */
        .mouth.intensity-low {
            transform: translateX(-50%) scale(0.85);
            opacity: 0.8;
        }

        .mouth.intensity-medium {
            transform: translateX(-50%) scale(1);
            opacity: 0.9;
        }

        .mouth.intensity-high {
            transform: translateX(-50%) scale(1.1);
            opacity: 1;
            filter: brightness(1.1);
        }

        .mouth.happy.intensity-high {
            transform: translateX(-50%) scale(1.15);
            height: 72px;
            border-radius: 0 0 135px 135px;
        }

        .mouth.sad.intensity-high {
            height: 38px;
            transform: translateX(-50%) rotate(180deg) scale(1.1);
        }

        .mouth.surprised.intensity-high {
            width: 28px;
            height: 38px;
            border-radius: 50%;
        }

        .mouth.surprised {
            width: 32px;
            height: 45px;
            border: 4px solid #333;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.6) 100%);
            animation: mouthShake 0.5s ease-in-out infinite;
        }

        .mouth.sad {
            width: 68px;
            height: 34px;
            border: 4px solid #333;
            border-bottom: none;
            border-radius: 68px 68px 0 0;
            background: transparent;
            transform: translateX(-50%) rotate(180deg);
        }

        .mouth.laugh {
            width: 145px;
            height: 75px;
            border-radius: 0 0 145px 145px;
            background: transparent;
            animation: mouthBounce 0.9s ease-in-out infinite;
            overflow: hidden;
            border-width: 6px;
        }

        .mouth.laugh::before {
            content: '';
            position: absolute;
            left: 18px;
            right: 18px;
            top: 0;
            height: 30px;
            background: linear-gradient(to bottom, #fff 0%, #f8f8f8 100%);
            border-bottom: 6px solid #000;
            border-radius: 0 0 15px 15px;
            box-shadow: inset 0 -3px 6px rgba(0,0,0,0.1);
        }

        .mouth.laugh::after {
            content: '';
            position: absolute;
            left: 15px;
            right: 15px;
            top: 20px;
            bottom: 10px;
            background: radial-gradient(circle at 50% 80%, #1b1b1b 0%, #111 60%, #0a0a0a 100%);
            border-radius: 0 0 115px 115px;
        }

        /* 表情驱动的眼睑/瞳孔/眉毛变化 */
        .face[data-expression="happy"] .lid.upper { transform: translateY(-2%); }
        .face[data-expression="happy"] .lid.lower { transform: translateY(8%); }
        .face[data-expression="happy"] .pupil { --pupil-scale: 1.0; }
        .face[data-expression="happy"] .eyebrow.left { transform: rotate(-8deg) translateY(-3px); }
        .face[data-expression="happy"] .eyebrow.right { transform: rotate(8deg) translateY(-3px); }

        .face[data-expression="surprised"] .lid.upper { transform: translateY(-28%); }
        .face[data-expression="surprised"] .lid.lower { transform: translateY(28%); }
        .face[data-expression="surprised"] .pupil { --pupil-scale: 0.85; }
        .face[data-expression="surprised"] .eyebrow.left,
        .face[data-expression="surprised"] .eyebrow.right { transform: translateY(-12px) rotate(0deg); }

        .face[data-expression="sad"] .lid.upper { transform: translateY(12%); }
        .face[data-expression="sad"] .lid.lower { transform: translateY(2%); }
        .face[data-expression="sad"] .pupil { --pupil-scale: 1.15; }
        .face[data-expression="sad"] .eyebrow.left { transform: rotate(15deg) translateY(6px); }
        .face[data-expression="sad"] .eyebrow.right { transform: rotate(-15deg) translateY(6px); }

        .face[data-expression="laugh"] .lid.upper { transform: translateY(18%); }
        .face[data-expression="laugh"] .lid.lower { transform: translateY(-4%); }
        .face[data-expression="laugh"] .pupil { --pupil-scale: 1.05; }

        /* 动画关键帧 */
        @keyframes subtle-pop {
            from { transform: scale(0.96); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        @keyframes eye-sparkle {
            0%, 100% {
                opacity: 0.9;
                transform: scale(1);
            }
            50% {
                opacity: 0.6;
                transform: scale(0.8);
            }
        }

        @keyframes blink {
            0%, 85%, 100% {
                transform: scaleY(1);
            }
            90% {
                transform: scaleY(0.3);
            }
            95% {
                transform: scaleY(0.05);
            }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
            20%, 40%, 60%, 80% { transform: translateX(3px); }
        }
        
        @keyframes glow-pulse {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
                filter: brightness(1);
            }
            50% { 
                box-shadow: 0 0 40px rgba(255, 215, 0, 0.6);
                filter: brightness(1.1);
            }
        }
        
        @keyframes color-shift {
            0% { filter: hue-rotate(0deg); }
            25% { filter: hue-rotate(90deg); }
            50% { filter: hue-rotate(180deg); }
            75% { filter: hue-rotate(270deg); }
            100% { filter: hue-rotate(360deg); }
        }

        /* 眨眼动画 */
        .eye.blinking .eyelid {
            animation: blink 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        @keyframes mouthPulse {
            0%, 100% { 
                transform: translateX(-50%) scale(1.05); 
                filter: brightness(1);
            }
            50% { 
                transform: translateX(-50%) scale(1.08); 
                filter: brightness(1.03);
            }
        }

        @keyframes mouthShake {
            0%, 100% { transform: translateX(-50%) rotate(0deg); }
            25% { transform: translateX(-50%) rotate(-2deg); }
            75% { transform: translateX(-50%) rotate(2deg); }
        }

        @keyframes mouthBounce {
            0%, 100% { 
                transform: translateX(-50%) translateY(0) scale(1); 
                filter: brightness(1);
            }
            50% { 
                transform: translateX(-50%) translateY(-3px) scale(1.02); 
                filter: brightness(1.02);
            }
        }

        /* UI 控件样式 */
        .controls {
            position: fixed;
            top: 20px;
            right: 30px;
            z-index: 30;
            background: rgba(255,255,255,0.12);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 16px;
            padding: 12px;
            display: flex;
            gap: 10px;
            align-items: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
        }

        .control-group {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .theme-dot {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            margin: 0 8px;
            transition: all 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            border: 3px solid rgba(255, 255, 255, 0.4);
            position: relative;
            transform: scale(1);
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.2),
                inset 0 2px 4px rgba(255, 255, 255, 0.3);
            overflow: hidden;
        }

        .theme-dot::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: rotate(-45deg);
            transition: transform 0.6s ease;
            opacity: 0;
        }

        .theme-dot:hover {
            transform: scale(1.25) rotate(3deg);
            border-color: rgba(255, 255, 255, 0.8);
            box-shadow: 
                0 8px 24px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(255, 255, 255, 0.2),
                inset 0 2px 6px rgba(255, 255, 255, 0.4);
        }

        .theme-dot:hover::before {
            opacity: 1;
            transform: rotate(-45deg) translateX(100%);
        }

        .theme-dot:active {
            transform: scale(1.05) rotate(-1deg);
            transition: transform 0.15s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .theme-dot[data-theme="blue"] {
            background: linear-gradient(135deg, #6ec3ff, #328bd7);
        }

        .theme-dot[data-theme="green"] {
            background: linear-gradient(135deg, #9be7a3, #38b06b);
        }

        .theme-dot[data-theme="brown"] {
            background: linear-gradient(135deg, #e0b38a, #a06a3e);
        }

        .theme-dot[data-theme="gray"] {
            background: linear-gradient(135deg, #cfe3ef, #7fa0b6);
        }

        .theme-dot.active {
            border-color: #FFD700;
            box-shadow: 
                0 6px 18px rgba(255, 215, 0, 0.4),
                0 0 15px rgba(255, 215, 0, 0.3),
                inset 0 2px 6px rgba(255, 255, 255, 0.5);
            transform: scale(1.1);
            animation: active-glow 2s ease-in-out infinite;
        }

        .theme-dot.active:hover {
            transform: scale(1.4) rotate(10deg);
            box-shadow: 
                0 10px 30px rgba(255, 215, 0, 0.5),
                0 0 25px rgba(255, 215, 0, 0.4),
                inset 0 3px 8px rgba(255, 255, 255, 0.6);
        }

        @keyframes active-glow {
            0%, 100% { 
                box-shadow: 
                    0 6px 18px rgba(255, 215, 0, 0.4),
                    0 0 15px rgba(255, 215, 0, 0.3),
                    inset 0 2px 6px rgba(255, 255, 255, 0.5);
            }
            50% { 
                box-shadow: 
                    0 8px 24px rgba(255, 215, 0, 0.6),
                    0 0 25px rgba(255, 215, 0, 0.5),
                    inset 0 3px 8px rgba(255, 255, 255, 0.7);
            }
        }

        .theme-dot:focus-visible {
            outline: 2px solid rgba(255,255,255,0.95);
            outline-offset: 2px;
            box-shadow: 0 0 0 3px rgba(0,0,0,0.25);
        }

        /* 提示文案 */
        .hint-text {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.8;
            max-width: 450px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .hint-text p {
            margin: 8px 0;
            transition: color 0.3s ease;
        }

        .hint-text:hover p {
            color: rgba(255, 255, 255, 1);
        }

        /* 装饰性浮动粒子 */
        .decorative-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .floating-particle {
            position: absolute;
            font-size: 20px;
            opacity: 0.6;
            animation: float 8s ease-in-out infinite;
            animation-delay: var(--delay);
            left: var(--x);
            top: var(--y);
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px) rotate(0deg);
                opacity: 0.6;
            }
            50% {
                transform: translateY(-20px) rotate(180deg);
                opacity: 0.8;
            }
        }

        @keyframes fadeOut {
            0% { opacity: 0; transform: translateY(6px); }
            10% { opacity: 0.92; transform: translateY(0); }
            80% { opacity: 0.8; }
            100% { opacity: 0; }
        }

        /* 无障碍与动效偏好 */
        @media (prefers-reduced-motion: reduce) {
            * { animation: none !important; transition: none !important; }
            .face { animation: none; }
        }

        /* 表情驱动的眼睑变化 */
        .emotion-happy .eyelid {
            transform: translateY(-2px);
        }

        .emotion-sad .eyelid {
            transform: translateY(2px);
        }

        .emotion-surprised .eyelid {
            transform: translateY(-8px);
        }

        .emotion-angry .eyelid {
            transform: translateY(1px) scaleY(0.7);
        }

        /* 表情驱动的瞳孔变化 */
        .emotion-happy .iris {
            transform: translate(-50%, -50%) scale(1.1);
        }

        .emotion-sad .iris {
            transform: translate(-50%, -50%) scale(0.9);
        }

        .emotion-surprised .iris {
            transform: translate(-50%, -50%) scale(1.3);
        }

        .emotion-angry .iris {
            transform: translate(-50%, -50%) scale(0.8);
        }

        /* 交互反馈效果 */
        .face {
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .face:hover {
            transform: scale(1.05);
            filter: brightness(1.1) saturate(1.2);
            box-shadow: 
                0 0 30px rgba(255, 215, 0, 0.4),
                0 0 60px rgba(255, 215, 0, 0.2),
                inset 0 2px 4px rgba(255, 255, 255, 0.3);
        }
        
        .face:active {
            transform: scale(0.95);
            filter: brightness(0.9) saturate(0.8);
            box-shadow: 
                0 0 15px rgba(255, 215, 0, 0.3),
                inset 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        /* 眼睛交互反馈 */
        .eye:hover {
            transform: scale(1.1);
            transition: transform 0.2s ease;
        }
        
        .eye:hover .iris {
            box-shadow: 
                0 0 15px rgba(139, 69, 19, 0.6),
                inset 2px 2px 4px rgba(160, 82, 45, 0.8),
                inset -2px -2px 4px rgba(101, 67, 33, 0.8);
        }
        
        /* 嘴巴交互反馈 */
        .mouth:hover {
            transform: scale(1.1);
            filter: brightness(1.2);
            transition: all 0.2s ease;
        }

        /* 动态背景色彩系统 */
        body.emotion-happy {
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 193, 7, 0.2), transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 235, 59, 0.15), transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(255, 152, 0, 0.1), transparent 50%),
                linear-gradient(135deg, #ffeb3b 0%, #ffc107 25%, #ff9800 50%, #ff5722 75%, #e91e63 100%);
        }

        body.emotion-sad {
            background: 
                radial-gradient(circle at 20% 80%, rgba(63, 81, 181, 0.3), transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(103, 58, 183, 0.2), transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(33, 150, 243, 0.15), transparent 50%),
                linear-gradient(135deg, #3f51b5 0%, #303f9f 25%, #1a237e 50%, #283593 75%, #3949ab 100%);
        }

        body.emotion-surprised {
            background: 
                radial-gradient(circle at 20% 80%, rgba(0, 188, 212, 0.3), transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 150, 136, 0.2), transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(76, 175, 80, 0.15), transparent 50%),
                linear-gradient(135deg, #00bcd4 0%, #009688 25%, #4caf50 50%, #8bc34a 75%, #cddc39 100%);
        }

        body.emotion-angry {
            background: 
                radial-gradient(circle at 20% 80%, rgba(244, 67, 54, 0.3), transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(233, 30, 99, 0.2), transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(156, 39, 176, 0.15), transparent 50%),
                linear-gradient(135deg, #f44336 0%, #e91e63 25%, #9c27b0 50%, #673ab7 75%, #3f51b5 100%);
        }
        
        /* 背景模式切换 */
        body.bg-mode-night {
            background: 
                radial-gradient(circle at 20% 30%, rgba(25, 25, 112, 0.4) 0%, transparent 60%),
                radial-gradient(circle at 80% 70%, rgba(72, 61, 139, 0.3) 0%, transparent 60%),
                linear-gradient(135deg, #0F0F23 0%, #1A1A2E 50%, #16213E 100%);
        }
        
        body.bg-mode-rainbow {
            background: 
                radial-gradient(circle at 25% 25%, rgba(255, 0, 150, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(0, 255, 150, 0.3) 0%, transparent 50%),
                linear-gradient(45deg, #FF6B6B 0%, #4ECDC4 25%, #45B7D1 50%, #96CEB4 75%, #FFEAA7 100%);
            animation: rainbow-shift 10s ease-in-out infinite;
        }
        
        body.bg-mode-minimal {
            background: linear-gradient(135deg, #F8F9FA 0%, #E9ECEF 100%);
        }
        
        @keyframes rainbow-shift {
            0%, 100% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(180deg); }
        }
        
        /* 夜间模式下的表情调整 */
        body.bg-mode-night .face {
            background: radial-gradient(circle at 30% 30%, #FFE135 0%, #FFC107 70%, #FF8F00 100%);
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.4),
                0 10px 20px rgba(255, 193, 7, 0.3),
                inset 0 2px 4px rgba(255, 255, 255, 0.4);
        }
        
        /* 彩虹模式下的表情调整 */
        body.bg-mode-rainbow .face {
            animation: face-rainbow 5s ease-in-out infinite;
        }
        
        @keyframes face-rainbow {
            0%, 100% { filter: hue-rotate(0deg) saturate(1); }
            25% { filter: hue-rotate(90deg) saturate(1.2); }
            50% { filter: hue-rotate(180deg) saturate(1.4); }
            75% { filter: hue-rotate(270deg) saturate(1.2); }
        }
        
        /* 简约模式下的表情调整 */
        body.bg-mode-minimal .face {
            background: linear-gradient(135deg, #FFF3C4 0%, #FFE082 100%);
            box-shadow: 
                0 10px 20px rgba(0, 0, 0, 0.1),
                0 5px 10px rgba(255, 193, 7, 0.2);
        }
        
        body.bg-mode-minimal .mouth {
            border-color: #666;
        }
        
        body.bg-mode-minimal .eyebrow {
            background: #666;
        }
        
        /* 提示文案样式 - 重新设计为左侧布局 */
        .hint-text {
            position: fixed;
            left: 30px;
            top: 50%;
            transform: translateY(-50%);
            text-align: left;
            color: rgba(255, 255, 255, 0.85);
            font-size: 13px;
            line-height: 1.8;
            max-width: 280px;
            padding: 25px 20px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.12);
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            z-index: 10;
        }
        
        .hint-text:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-50%) translateX(5px);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.18);
            border-color: rgba(255, 255, 255, 0.25);
        }
        
        .hint-text p {
            margin: 6px 0;
            opacity: 0.88;
            transition: all 0.3s ease;
            font-weight: 400;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .hint-text p:hover {
            opacity: 1;
            color: #fff;
            transform: translateX(3px);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        /* 装饰性元素样式 */
        .decorative-elements {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }
        
        .floating-particle {
            position: absolute;
            font-size: 20px;
            opacity: 0.6;
            animation: float-around 8s infinite ease-in-out;
            animation-delay: var(--delay, 0s);
            left: var(--x, 50%);
            top: var(--y, 50%);
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5));
        }
        
        @keyframes float-around {
            0%, 100% {
                transform: translate(0, 0) rotate(0deg) scale(1);
                opacity: 0.6;
            }
            25% {
                transform: translate(20px, -30px) rotate(90deg) scale(1.2);
                opacity: 0.8;
            }
            50% {
                transform: translate(-15px, -20px) rotate(180deg) scale(0.8);
                opacity: 1;
            }
            75% {
                transform: translate(-25px, 15px) rotate(270deg) scale(1.1);
                opacity: 0.7;
            }
        }
        
        /* 背景模式下的装饰元素调整 */
        .bg-mode-night .floating-particle {
            filter: drop-shadow(0 0 15px rgba(100, 200, 255, 0.8));
        }
        
        .bg-mode-rainbow .floating-particle {
            animation: float-around 8s infinite ease-in-out, rainbow-glow 3s infinite;
        }
        
        @keyframes rainbow-glow {
            0% { filter: drop-shadow(0 0 10px #ff6b6b); }
            16% { filter: drop-shadow(0 0 10px #ffa500); }
            33% { filter: drop-shadow(0 0 10px #ffff00); }
            50% { filter: drop-shadow(0 0 10px #00ff00); }
            66% { filter: drop-shadow(0 0 10px #00bfff); }
            83% { filter: drop-shadow(0 0 10px #8a2be2); }
            100% { filter: drop-shadow(0 0 10px #ff6b6b); }
        }

        /* 响应式设计 */
        @media (max-width: 1200px) {
            .hint-text {
                left: 20px;
                max-width: 250px;
                font-size: 12px;
                padding: 20px 15px;
            }
        }
        
        @media (max-width: 768px) {
            .emoji-container {
                width: 250px;
                height: 250px;
            }
            
            .eyes {
                gap: 40px;
            }
            
            .eye {
                width: 50px;
                height: 50px;
            }
            
            .iris {
                width: 30px;
                height: 30px;
            }
            
            .pupil {
                width: 12px;
                height: 12px;
            }
            
            .hint-text {
                position: fixed;
                bottom: 20px;
                left: 50%;
                top: auto;
                transform: translateX(-50%);
                text-align: center;
                max-width: 90%;
                font-size: 11px;
                padding: 15px;
            }
            
            .controls {
                top: 15px;
                right: 15px;
                transform: scale(0.9);
            }
        }

        @media (max-width: 480px) {
            .emoji-container {
                width: 200px;
                height: 200px;
            }
            
            .eyes {
                gap: 35px;
            }
            
            .eye {
                width: 40px;
                height: 40px;
            }
            
            .iris {
                width: 24px;
                height: 24px;
            }
            
            .pupil {
                width: 10px;
                height: 10px;
            }
            
            .controls {
                transform: scale(0.8);
                top: 10px;
                right: 10px;
            }
            
            .hint-text {
                bottom: 15px;
                font-size: 10px;
                padding: 12px;
                max-width: 95%;
            }
            
            .floating-particle {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="emoji-container">
        <div class="face" data-expression="neutral">
            <!-- 眉毛 -->
            <div class="eyebrow left"></div>
            <div class="eyebrow right"></div>
            
            <!-- 眼睛 -->
            <div class="eyes">
                <div class="eye left">
                    <div class="lid upper"></div>
                    <div class="lid lower"></div>
                    <div class="iris">
                        <div class="pupil"></div>
                    </div>
                </div>
                <div class="eye right">
                    <div class="lid upper"></div>
                    <div class="lid lower"></div>
                    <div class="iris">
                        <div class="pupil"></div>
                    </div>
                </div>
            </div>
            
            <!-- 嘴巴 -->
            <div class="mouth neutral"></div>
        </div>
        
        <!-- 控制面板 -->
        <div class="controls">
            <div class="control-group">
                <div class="theme-dot" data-function="background" aria-label="背景模式切换" title="背景模式切换" tabindex="0">🌙</div>
                <div class="theme-dot" data-function="iris" aria-label="虹膜主题循环" title="虹膜主题循环" tabindex="0">👁️</div>
                <div class="theme-dot" data-function="animation" aria-label="动画模式切换" title="动画模式切换" tabindex="0">⚡</div>
                <div class="theme-dot" data-function="random" aria-label="随机表情" title="随机表情" tabindex="0">🎲</div>
            </div>
        </div>
        
        <!-- 提示文案 -->
        <div class="hint-text">
            <p>👀 眼睛会跟随你的鼠标移动</p>
            <p>😊 嘴巴会根据鼠标距离变化表情</p>
            <p>🌙 点击月亮切换背景模式</p>
            <p>👁️ 点击眼睛循环虹膜主题</p>
            <p>⚡ 点击闪电切换动画模式</p>
            <p>🎲 点击骰子随机表情</p>
            <p>⌨️ 按键盘 1-5 快速切换表情</p>
            <p>✨ 悬停在表情上查看交互效果</p>
        </div>

        <!-- 装饰性元素 -->
        <div class="decorative-elements">
            <div class="floating-particle" style="--delay: 0s; --x: 10%; --y: 20%;">✨</div>
            <div class="floating-particle" style="--delay: 2s; --x: 85%; --y: 15%;">💫</div>
            <div class="floating-particle" style="--delay: 4s; --x: 15%; --y: 80%;">⭐</div>
            <div class="floating-particle" style="--delay: 6s; --x: 90%; --y: 75%;">✨</div>
            <div class="floating-particle" style="--delay: 1s; --x: 50%; --y: 10%;">🌟</div>
            <div class="floating-particle" style="--delay: 3s; --x: 5%; --y: 50%;">💫</div>
        </div>
    </div>

    <script>
        // 表情状态管理系统
        class EmotionManager {
            constructor() {
                this.currentExpression = 'neutral';
                this.currentMouthState = 'neutral';
                this.isAnimating = false;
                this.mousePosition = { x: 0, y: 0 };
                this.faceElement = document.querySelector('.face');
                this.mouthElement = document.querySelector('.mouth');
                this.irisElements = document.querySelectorAll('.iris');
                this.expressions = ['neutral', 'happy', 'surprised', 'sad', 'laugh'];
                this.mouthStates = ['neutral', 'happy', 'surprised', 'sad', 'laugh'];
                
                // 动画同步机制
                this.animationQueue = [];
                this.isAnimationRunning = false;
                this.animationStartTime = 0;
                this.lastAnimationFrame = 0;
                
                // 新增状态管理
                this.currentIrisTheme = 'blue';
                this.currentBackgroundMode = 'default';
                this.animationMode = 'normal';
                this.animationEnabled = true; // 动画启用状态
                this.blinkInterval = null; // 眨眼定时器
                this.backgroundModes = ['default', 'night', 'rainbow', 'minimal'];
                this.irisThemes = ['blue', 'green', 'brown', 'gray', 'purple', 'amber'];
                
                this.init();
            }
            
            init() {
                this.setupMouseTracking();
                this.setupMouthTriggers();
                this.setupThemeControls();
                this.setupKeyboardControls();
                this.setupBlinking();
                this.loadSavedTheme();
                this.startAnimationLoop();
                
                // 设置默认主题
                document.body.setAttribute('data-iris-theme', this.currentIrisTheme);
                if (this.currentBackgroundMode !== 'default') {
                    document.body.classList.add(`bg-mode-${this.currentBackgroundMode}`);
                }
            }
            
            // 动画同步系统
            startAnimationLoop() {
                const animate = (timestamp) => {
                    if (!this.lastAnimationFrame) {
                        this.lastAnimationFrame = timestamp;
                    }
                    
                    const deltaTime = timestamp - this.lastAnimationFrame;
                    this.processAnimationQueue(deltaTime);
                    this.lastAnimationFrame = timestamp;
                    
                    requestAnimationFrame(animate);
                };
                requestAnimationFrame(animate);
            }
            
            processAnimationQueue(deltaTime) {
                if (this.animationQueue.length === 0) {
                    this.isAnimationRunning = false;
                    return;
                }
                
                this.isAnimationRunning = true;
                const currentAnimation = this.animationQueue[0];
                
                if (!currentAnimation.startTime) {
                    currentAnimation.startTime = performance.now();
                }
                
                const elapsed = performance.now() - currentAnimation.startTime;
                const progress = Math.min(elapsed / currentAnimation.duration, 1);
                
                // 执行动画
                currentAnimation.update(progress);
                
                // 动画完成，移除队列
                if (progress >= 1) {
                    if (currentAnimation.onComplete) {
                        currentAnimation.onComplete();
                    }
                    this.animationQueue.shift();
                }
            }
            
            addToAnimationQueue(animation) {
                this.animationQueue.push(animation);
            }
            
            // 统一的动画触发方法
            triggerSynchronizedAnimation(type, params = {}) {
                const animation = {
                    type: type,
                    duration: params.duration || 350,
                    startTime: null,
                    update: (progress) => {
                        const easeProgress = this.easeInOutCubic(progress);
                        
                        switch (type) {
                            case 'expression_change':
                                this.updateExpressionAnimation(easeProgress, params);
                                break;
                            case 'eye_movement':
                                this.updateEyeMovementAnimation(easeProgress, params);
                                break;
                            case 'eyebrow_sync':
                                this.updateEyebrowSyncAnimation(easeProgress, params);
                                break;
                        }
                    },
                    onComplete: params.onComplete
                };
                
                this.addToAnimationQueue(animation);
            }
            
            easeInOutCubic(t) {
                return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
            }
            
            updateExpressionAnimation(progress, params) {
                // 同步眼睛、眉毛、嘴巴的表情变化
                const intensity = progress * params.intensity || progress;
                
                if (params.eyeChanges) {
                    this.applyEyeChanges(params.eyeChanges, intensity);
                }
                if (params.eyebrowChanges) {
                    this.applyEyebrowChanges(params.eyebrowChanges, intensity);
                }
                if (params.mouthChanges) {
                    this.applyMouthChanges(params.mouthChanges, intensity);
                }
            }
            
            updateEyeMovementAnimation(progress, params) {
                // 眼睛移动时的协调动画
                const smoothProgress = this.easeInOutCubic(progress);
                
                if (params.eyePosition) {
                    this.updateEyePosition(params.eyePosition, smoothProgress);
                }
                if (params.eyebrowFollow) {
                    this.updateEyebrowFollow(params.eyebrowFollow, smoothProgress);
                }
            }
            
            updateEyebrowSyncAnimation(progress, params) {
                // 眉毛同步动画
                const eyebrows = document.querySelectorAll('.eyebrow');
                eyebrows.forEach((eyebrow, index) => {
                    if (params.transforms && params.transforms[index]) {
                        const transform = params.transforms[index];
                        const currentTransform = this.interpolateTransform(transform.from, transform.to, progress);
                        eyebrow.style.transform = currentTransform;
                    }
                });
            }
            
            interpolateTransform(from, to, progress) {
                // 插值计算变换
                const fromValues = this.parseTransform(from);
                const toValues = this.parseTransform(to);
                const result = {};
                
                for (let key in fromValues) {
                    if (toValues[key] !== undefined) {
                        result[key] = fromValues[key] + (toValues[key] - fromValues[key]) * progress;
                    }
                }
                
                return this.buildTransformString(result);
            }
            
            parseTransform(transformString) {
                // 解析transform字符串
                const result = { translateY: 0, rotate: 0, scaleY: 1 };
                const matches = transformString.match(/(\w+)\(([^)]+)\)/g);
                
                if (matches) {
                    matches.forEach(match => {
                        const [, func, value] = match.match(/(\w+)\(([^)]+)\)/);
                        result[func] = parseFloat(value);
                    });
                }
                
                return result;
            }
            
            buildTransformString(values) {
                // 构建transform字符串
                let transform = '';
                if (values.translateY !== undefined) transform += `translateY(${values.translateY}px) `;
                if (values.rotate !== undefined) transform += `rotate(${values.rotate}deg) `;
                if (values.scaleY !== undefined) transform += `scaleY(${values.scaleY}) `;
                return transform.trim();
            }
            
            setupBlinking() {
                const eyes = document.querySelectorAll('.eye');
                
                const blink = () => {
                    if (!this.animationEnabled) return; // 检查动画是否启用
                    
                    eyes.forEach(eye => {
                        eye.classList.add('blinking');
                        setTimeout(() => {
                            eye.classList.remove('blinking');
                        }, 300);
                    });
                };
                
                // 随机眨眼间隔 2-6秒
                const scheduleNextBlink = () => {
                    if (!this.animationEnabled) {
                        // 如果动画被禁用，延迟检查
                        this.blinkInterval = setTimeout(scheduleNextBlink, 1000);
                        return;
                    }
                    
                    const interval = Math.random() * 4000 + 2000;
                    this.blinkInterval = setTimeout(() => {
                        blink();
                        scheduleNextBlink();
                    }, interval);
                };
                
                scheduleNextBlink();
            }
            
            // 停止眨眼动画
            stopBlinking() {
                if (this.blinkInterval) {
                    clearTimeout(this.blinkInterval);
                    this.blinkInterval = null;
                }
            }
            
            // 重新启动眨眼动画
            restartBlinking() {
                this.stopBlinking();
                this.setupBlinking();
            }
            
            // 鼠标追踪眼睛功能
            setupMouseTracking() {
                let isMouseMoving = false;
                let mouseTimeout;
                let clickCount = 0;
                
                document.addEventListener('mousemove', (e) => {
                    isMouseMoving = true;
                    clearTimeout(mouseTimeout);
                    
                    this.mousePosition.x = e.clientX;
                    this.mousePosition.y = e.clientY;
                    this.updateEyeTracking();
                    
                    mouseTimeout = setTimeout(() => {
                        isMouseMoving = false;
                    }, 100);
                });
                
                // 添加点击交互
                this.faceElement.addEventListener('click', (e) => {
                    clickCount++;
                    this.triggerClickResponse(clickCount);
                    
                    setTimeout(() => {
                        clickCount = Math.max(0, clickCount - 1);
                    }, 1000);
                });
                
                // 添加长按交互
                let pressTimer;
                this.faceElement.addEventListener('mousedown', () => {
                    pressTimer = setTimeout(() => {
                        this.triggerLongPressResponse();
                    }, 800);
                });
                
                this.faceElement.addEventListener('mouseup', () => {
                    clearTimeout(pressTimer);
                });
                
                // 添加悬停效果
                let hoverTimer;
                this.faceElement.addEventListener('mouseenter', () => {
                    hoverTimer = setTimeout(() => {
                        this.triggerHoverEffect();
                    }, 2000); // 悬停2秒后触发特效
                });
                
                this.faceElement.addEventListener('mouseleave', () => {
                    clearTimeout(hoverTimer);
                    this.clearHoverEffect();
                });
            }
            
            triggerHoverEffect() {
                // 长时间悬停发光效果
                this.faceElement.style.animation = 'glow-pulse 3s infinite';
            }
            
            clearHoverEffect() {
                // 清除悬停效果
                if (this.faceElement.style.animation.includes('glow-pulse')) {
                    this.faceElement.style.animation = 'none';
                }
            }
            
            triggerClickResponse(clickCount) {
                const expressions = ['happy', 'surprised', 'neutral', 'sad'];
                const expression = expressions[clickCount % expressions.length];
                this.setExpression(expression);
                
                // 添加点击动画和特效
                this.faceElement.style.animation = 'none';
                setTimeout(() => {
                    if (clickCount >= 3) {
                        // 连续点击触发彩虹效果
                        this.faceElement.style.animation = 'color-shift 2s ease, subtle-pop 0.3s ease';
                    } else {
                        this.faceElement.style.animation = 'subtle-pop 0.3s ease';
                    }
                }, 10);
                
                // 双击特效
                if (clickCount === 2) {
                    this.triggerDoubleClickEffect();
                }
            }
            
            triggerDoubleClickEffect() {
                // 双击发光效果
                this.faceElement.style.animation = 'glow-pulse 1s ease';
                
                // 眼睛闪烁效果
                const eyes = document.querySelectorAll('.eye');
                eyes.forEach(eye => {
                    eye.style.animation = 'eye-sparkle 0.5s ease';
                });
                
                setTimeout(() => {
                    this.faceElement.style.animation = 'none';
                    eyes.forEach(eye => {
                        eye.style.animation = 'none';
                    });
                }, 1000);
            }
            
            triggerLongPressResponse() {
                // 长按触发特殊表情
                this.setExpression('angry');
                
                // 添加震动效果
                this.faceElement.style.animation = 'shake 0.5s ease';
                setTimeout(() => {
                    this.faceElement.style.animation = 'none';
                }, 500);
            }
            
            updateEyeTracking() {
                const container = document.querySelector('.emoji-container');
                const containerRect = container.getBoundingClientRect();
                const centerX = containerRect.left + containerRect.width / 2;
                const centerY = containerRect.top + containerRect.height / 2;
                
                const deltaX = this.mousePosition.x - centerX;
                const deltaY = this.mousePosition.y - centerY;
                const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                
                // 调整眼球移动范围，使其与150%放大后的面部比例协调
                const maxMove = 14; // 适度减少移动范围，保持协调性
                const sensitivity = 0.035; // 降低敏感度，避免过度夸张
                const moveX = Math.max(-maxMove, Math.min(maxMove, deltaX * sensitivity));
                const moveY = Math.max(-maxMove, Math.min(maxMove, deltaY * sensitivity));
                
                // 根据鼠标距离动态调整眼睛大小（适度调整变化幅度）
                const maxDistance = 300;
                const normalizedDistance = Math.min(distance / maxDistance, 1);
                const eyeScale = 1 + (normalizedDistance * 0.2); // 眼睛可放大到1.2倍，更协调
                const irisScale = 1 + (normalizedDistance * 0.25); // 虹膜可放大到1.25倍，保持自然
                
                // 根据移动方向调整眼睛形状（减少变形幅度）
                const horizontalStretch = 1 + Math.abs(moveX) * 0.015; // 降低水平拉伸
                const verticalStretch = 1 + Math.abs(moveY) * 0.015; // 降低垂直拉伸
                
                // 添加微妙的弹性效果和自然缓动
                const currentTime = Date.now();
                if (!this.lastUpdateTime) this.lastUpdateTime = currentTime;
                const deltaTime = Math.max(currentTime - this.lastUpdateTime, 1);
                
                // 计算速度变化产生的弹性效果
                const velocityX = (moveX - (this.lastMoveX || 0)) / deltaTime * 1000;
                const velocityY = (moveY - (this.lastMoveY || 0)) / deltaTime * 1000;
                
                // 添加微妙的振荡效果，让眼睛运动更生动
                const oscillationX = Math.sin(currentTime * 0.003) * 0.3;
                const oscillationY = Math.cos(currentTime * 0.002) * 0.2;
                
                // 根据速度添加弹性偏移
                const elasticX = Math.sin(velocityX * 0.01) * 0.8;
                const elasticY = Math.sin(velocityY * 0.01) * 0.8;
                
                const finalMoveX = moveX + elasticX + oscillationX;
                const finalMoveY = moveY + elasticY + oscillationY;
                
                const eyes = document.querySelectorAll('.eye');
                eyes.forEach(eye => {
                    eye.style.transform = `scale(${eyeScale}) scaleX(${horizontalStretch}) scaleY(${verticalStretch})`;
                });
                
                this.irisElements.forEach(iris => {
                    iris.style.transform = `translate(calc(-50% + ${finalMoveX}px), calc(-50% + ${finalMoveY}px)) scale(${irisScale})`;
                });
                
                // 存储当前值用于下次计算
                this.lastUpdateTime = currentTime;
                this.lastMoveX = moveX;
                this.lastMoveY = moveY;
                
                // 根据鼠标距离触发嘴巴状态变化
                this.updateMouthBasedOnDistance(deltaX, deltaY);
                
                // 触发眉毛跟随眼睛运动
                this.updateEyebrowsBasedOnEyeMovement(finalMoveX, finalMoveY, normalizedDistance);
            }
            
            // 眉毛跟随眼睛运动的函数
            updateEyebrowsBasedOnEyeMovement(moveX, moveY, distance) {
                const leftEyebrow = document.querySelector('.eyebrow.left');
                const rightEyebrow = document.querySelector('.eyebrow.right');
                
                // 基础角度
                const baseLeftAngle = -15;
                const baseRightAngle = 15;
                
                // 根据眼睛移动调整眉毛角度和位置
                const angleAdjustment = moveX * 0.8; // 水平移动影响角度
                const verticalAdjustment = moveY * 0.5; // 垂直移动影响高度
                const distanceEffect = distance * 15; // 距离影响眉毛上下移动
                
                // 左眉毛变化
                const leftAngle = baseLeftAngle + angleAdjustment;
                const leftVerticalOffset = -verticalAdjustment - distanceEffect;
                leftEyebrow.style.transform = `rotate(${leftAngle}deg) translateY(${leftVerticalOffset}px)`;
                
                // 右眉毛变化
                const rightAngle = baseRightAngle + angleAdjustment;
                const rightVerticalOffset = -verticalAdjustment - distanceEffect;
                rightEyebrow.style.transform = `rotate(${rightAngle}deg) translateY(${rightVerticalOffset}px)`;
                
                // 根据眼睛移动幅度调整眉毛粗细
                const eyeMovementIntensity = Math.sqrt(moveX * moveX + moveY * moveY) / 18;
                const browThickness = 9 + (eyeMovementIntensity * 3); // 基础9px，最大12px
                leftEyebrow.style.height = `${browThickness}px`;
                rightEyebrow.style.height = `${browThickness}px`;
            }
            
            // 基于鼠标位置和时间间隔的嘴巴状态触发机制
            setupMouthTriggers() {
                // 定时随机变化嘴巴状态
                setInterval(() => {
                    if (!this.isAnimating && Math.random() < 0.3) {
                        this.randomMouthExpression();
                    }
                }, 3000);
                
                // 点击表情时改变嘴巴状态
                this.faceElement.addEventListener('click', () => {
                    this.cycleMouthExpression();
                });
            }
            
            updateMouthBasedOnDistance(deltaX, deltaY) {
                const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                const maxDistance = Math.sqrt(window.innerWidth ** 2 + window.innerHeight ** 2);
                const normalizedDistance = Math.min(distance / maxDistance, 1);
                
                // 增强的嘴巴响应逻辑
                if (normalizedDistance < 0.1) {
                    this.setMouthState('happy');
                    this.setMouthIntensity('high');
                } else if (normalizedDistance < 0.25) {
                    this.setMouthState('happy');
                    this.setMouthIntensity('medium');
                } else if (normalizedDistance < 0.4) {
                    this.setMouthState('neutral');
                    this.setMouthIntensity('low');
                } else if (normalizedDistance < 0.7) {
                    this.setMouthState('surprised');
                    this.setMouthIntensity('medium');
                } else {
                    this.setMouthState('sad');
                    this.setMouthIntensity('high');
                }
            }
            
            setMouthIntensity(intensity) {
                const mouth = document.querySelector('.mouth');
                mouth.classList.remove('intensity-low', 'intensity-medium', 'intensity-high');
                mouth.classList.add(`intensity-${intensity}`);
            }
            
            // 设置表情状态
            setExpression(expression) {
                if (this.isAnimationRunning || !this.expressions.includes(expression)) return;
                
                this.currentExpression = expression;
                
                // 使用同步动画系统
                this.triggerSynchronizedAnimation('expression_change', {
                    duration: 350,
                    intensity: 1,
                    eyeChanges: this.getExpressionEyeChanges(expression),
                    eyebrowChanges: this.getExpressionEyebrowChanges(expression),
                    mouthChanges: this.getExpressionMouthChanges(expression),
                    onComplete: () => {
                        // 移除所有表情类
                        document.body.classList.remove('emotion-happy', 'emotion-sad', 'emotion-surprised', 'emotion-angry');
                        
                        // 更新面部表情
                        this.faceElement.setAttribute('data-expression', expression);
                        
                        // 添加新的表情类到body
                        if (expression && expression !== 'neutral') {
                            document.body.classList.add(`emotion-${expression}`);
                        }
                        
                        // 同步更新嘴巴状态
                        this.setMouthState(expression);
                    }
                });
            }
            
            getExpressionEyeChanges(expression) {
                // 根据表情返回眼睛变化参数
                const changes = {
                    scale: 1,
                    shape: 'normal'
                };
                
                switch(expression) {
                    case 'happy':
                    case 'laugh':
                        changes.scale = 0.9;
                        changes.shape = 'squint';
                        break;
                    case 'surprised':
                        changes.scale = 1.3;
                        changes.shape = 'wide';
                        break;
                    case 'sad':
                        changes.scale = 0.95;
                        changes.shape = 'droopy';
                        break;
                }
                
                return changes;
            }
            
            getExpressionEyebrowChanges(expression) {
                // 根据表情返回眉毛变化参数
                const changes = {
                    angle: 0,
                    position: 0,
                    thickness: 9
                };
                
                switch(expression) {
                    case 'happy':
                    case 'laugh':
                        changes.angle = -8;
                        changes.position = -3;
                        changes.thickness = 8;
                        break;
                    case 'sad':
                        changes.angle = 12;
                        changes.position = 2;
                        changes.thickness = 10;
                        break;
                    case 'surprised':
                        changes.angle = 0;
                        changes.position = -8;
                        changes.thickness = 7;
                        break;
                    case 'angry':
                        changes.angle = 15;
                        changes.position = 5;
                        changes.thickness = 12;
                        break;
                }
                
                return changes;
            }
            
            getExpressionMouthChanges(expression) {
                // 根据表情返回嘴巴变化参数
                return {
                    state: expression,
                    intensity: this.getMouthIntensityForExpression(expression)
                };
            }
            
            getMouthIntensityForExpression(expression) {
                switch(expression) {
                    case 'laugh':
                        return 'high';
                    case 'happy':
                    case 'surprised':
                        return 'medium';
                    default:
                        return 'low';
                }
            }
            
            // 设置嘴巴状态
            setMouthState(state) {
                if (!this.mouthStates.includes(state)) return;
                
                this.currentMouthState = state;
                
                // 使用同步动画系统触发眉毛跟随
                this.triggerSynchronizedAnimation('eyebrow_sync', {
                    duration: 180, // 与眉毛过渡时间一致
                    transforms: this.getEyebrowTransformsForMouthState(state),
                    onComplete: () => {
                        this.mouthElement.className = `mouth ${state}`;
                    }
                });
            }
            
            getEyebrowTransformsForMouthState(mouthState) {
                const leftEyebrow = document.querySelector('.eyebrow.left');
                const rightEyebrow = document.querySelector('.eyebrow.right');
                
                if (!leftEyebrow || !rightEyebrow) return [];
                
                // 获取当前变换
                const currentLeftTransform = leftEyebrow.style.transform || 'rotate(-15deg) translateY(0px)';
                const currentRightTransform = rightEyebrow.style.transform || 'rotate(15deg) translateY(0px)';
                
                // 基础角度
                const baseLeftAngle = -15;
                const baseRightAngle = 15;
                
                // 根据嘴巴状态计算目标变换
                let angleAdjustment = 0;
                let verticalOffset = 0;
                let browThickness = 9;
                
                switch(mouthState) {
                    case 'happy':
                    case 'laugh':
                        angleAdjustment = -8;
                        verticalOffset = -3;
                        browThickness = 8;
                        break;
                    case 'sad':
                        angleAdjustment = 12;
                        verticalOffset = 2;
                        browThickness = 10;
                        break;
                    case 'surprised':
                        angleAdjustment = 0;
                        verticalOffset = -8;
                        browThickness = 7;
                        break;
                    case 'angry':
                        angleAdjustment = 15;
                        verticalOffset = 5;
                        browThickness = 12;
                        break;
                    case 'neutral':
                    default:
                        angleAdjustment = 0;
                        verticalOffset = 0;
                        browThickness = 9;
                        break;
                }
                
                const leftAngle = baseLeftAngle + angleAdjustment;
                const rightAngle = baseRightAngle - angleAdjustment;
                
                const targetLeftTransform = `rotate(${leftAngle}deg) translateY(${verticalOffset}px)`;
                const targetRightTransform = `rotate(${rightAngle}deg) translateY(${verticalOffset}px)`;
                
                // 同时更新眉毛粗细
                setTimeout(() => {
                    leftEyebrow.style.height = `${browThickness}px`;
                    rightEyebrow.style.height = `${browThickness}px`;
                }, 90); // 在动画中途更新粗细
                
                return [
                    {
                        from: currentLeftTransform,
                        to: targetLeftTransform
                    },
                    {
                        from: currentRightTransform,
                        to: targetRightTransform
                    }
                ];
            }
            
            // 眉毛跟随嘴巴表情变化的函数
            updateEyebrowsBasedOnMouthState(mouthState) {
                const leftEyebrow = document.querySelector('.eyebrow.left');
                const rightEyebrow = document.querySelector('.eyebrow.right');
                
                if (!leftEyebrow || !rightEyebrow) return;
                
                // 基础角度
                const baseLeftAngle = -15;
                const baseRightAngle = 15;
                
                // 根据嘴巴状态调整眉毛
                let angleAdjustment = 0;
                let verticalOffset = 0;
                let browThickness = 9;
                
                switch(mouthState) {
                    case 'happy':
                    case 'laugh':
                        angleAdjustment = -8; // 眉毛向下倾斜，显得更开心
                        verticalOffset = -3;
                        browThickness = 8; // 稍微变细
                        break;
                    case 'sad':
                        angleAdjustment = 12; // 眉毛向上倾斜，显得忧伤
                        verticalOffset = 2;
                        browThickness = 10; // 稍微变粗
                        break;
                    case 'surprised':
                        angleAdjustment = 0; // 保持水平
                        verticalOffset = -8; // 眉毛上扬
                        browThickness = 7; // 变细
                        break;
                    case 'angry':
                        angleAdjustment = 15; // 眉毛向内倾斜
                        verticalOffset = 5; // 眉毛下压
                        browThickness = 12; // 变粗
                        break;
                    case 'neutral':
                    default:
                        angleAdjustment = 0;
                        verticalOffset = 0;
                        browThickness = 9;
                        break;
                }
                
                // 应用变化
                const leftAngle = baseLeftAngle + angleAdjustment;
                const rightAngle = baseRightAngle - angleAdjustment; // 右眉毛相反方向
                
                leftEyebrow.style.transform = `rotate(${leftAngle}deg) translateY(${verticalOffset}px)`;
                rightEyebrow.style.transform = `rotate(${rightAngle}deg) translateY(${verticalOffset}px)`;
                leftEyebrow.style.height = `${browThickness}px`;
                rightEyebrow.style.height = `${browThickness}px`;
            }
            
            // 随机表情
            randomExpression() {
                const randomExp = this.expressions[Math.floor(Math.random() * this.expressions.length)];
                this.setExpression(randomExp);
            }
            
            // 随机嘴巴表情
            randomMouthExpression() {
                const randomMouth = this.mouthStates[Math.floor(Math.random() * this.mouthStates.length)];
                this.setMouthState(randomMouth);
            }
            
            // 循环切换嘴巴表情
            cycleMouthExpression() {
                const currentIndex = this.mouthStates.indexOf(this.currentMouthState);
                const nextIndex = (currentIndex + 1) % this.mouthStates.length;
                this.setMouthState(this.mouthStates[nextIndex]);
            }
            
            // 虹膜主题控制
            applyIrisTheme(theme) {
                // 更新当前主题
                this.currentIrisTheme = theme;
                
                // 使用CSS变量方式设置主题
                document.body.setAttribute('data-iris-theme', theme);
                
                this.saveTheme(theme);
            }
            
            saveTheme(theme) {
                try {
                    localStorage.setItem('irisTheme', theme);
                } catch (e) {
                    console.warn('无法保存主题设置:', e);
                }
            }
            
            loadSavedTheme() {
                let savedTheme = 'blue';
                try {
                    savedTheme = localStorage.getItem('irisTheme') || 'blue';
                } catch (e) {
                    console.warn('无法加载主题设置:', e);
                }
                
                // 确保保存的主题在可用主题列表中
                if (this.irisThemes.includes(savedTheme)) {
                    this.currentIrisTheme = savedTheme;
                }
                
                this.applyIrisTheme(this.currentIrisTheme);
            }
            
            // 主题控制设置
            setupThemeControls() {
                const themeDots = document.querySelectorAll('.theme-dot');
                
                // 为每个按钮定义功能
                const buttonFunctions = [
                    () => this.toggleBackgroundMode(), // 第一个按钮：背景模式切换
                    () => this.cycleIrisTheme(),       // 第二个按钮：虹膜主题循环
                    () => this.toggleAnimationMode(),  // 第三个按钮：动画模式切换
                    () => this.randomizeExpression()   // 第四个按钮：随机表情
                ];
                
                themeDots.forEach((dot, index) => {
                    // 添加按钮标识
                    dot.setAttribute('data-function', ['background', 'iris', 'animation', 'random'][index]);
                    
                    dot.addEventListener('click', () => {
                        // 执行对应功能
                        if (buttonFunctions[index]) {
                            buttonFunctions[index]();
                        }
                        
                        // 临时高亮效果
                        dot.classList.add('active');
                        setTimeout(() => {
                            if (!dot.classList.contains('permanent-active')) {
                                dot.classList.remove('active');
                            }
                        }, 500);
                    });
                    
                    dot.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            dot.click();
                        }
                    });
                });
            }
            
            toggleBackgroundMode() {
                const currentIndex = this.backgroundModes.indexOf(this.currentBackgroundMode);
                const nextIndex = (currentIndex + 1) % this.backgroundModes.length;
                this.currentBackgroundMode = this.backgroundModes[nextIndex];
                
                const body = document.body;
                // 清除所有背景模式类
                body.className = body.className.replace(/bg-mode-\w+/g, '');
                
                // 添加新的背景模式类（除了default）
                if (this.currentBackgroundMode !== 'default') {
                    body.classList.add(`bg-mode-${this.currentBackgroundMode}`);
                }
            }
            
            cycleIrisTheme() {
                const currentIndex = this.irisThemes.indexOf(this.currentIrisTheme);
                const nextIndex = (currentIndex + 1) % this.irisThemes.length;
                this.currentIrisTheme = this.irisThemes[nextIndex];
                
                this.applyIrisTheme(this.currentIrisTheme);
            }
            
            toggleAnimationMode() {
                this.animationEnabled = !this.animationEnabled;
                const button = document.querySelector('[data-function="animation"]');
                
                if (this.animationEnabled) {
                    // 启用动画模式
                    button.classList.add('permanent-active');
                    button.style.backgroundColor = '#4ade80'; // 绿色表示启用
                    this.restartBlinking(); // 重新启动眨眼动画
                    
                    // 显示启用提示
                    this.showModeIndicator('动画已启用', '#4ade80');
                } else {
                    // 禁用动画模式
                    button.classList.remove('permanent-active');
                    button.style.backgroundColor = '#ef4444'; // 红色表示禁用
                    this.stopBlinking(); // 停止眨眼动画
                    
                    // 显示禁用提示
                    this.showModeIndicator('动画已禁用', '#ef4444');
                }
            }
            
            // 显示模式切换指示器
            showModeIndicator(text, color) {
                // 创建临时指示器
                const indicator = document.createElement('div');
                indicator.textContent = text;
                indicator.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: ${color};
                    color: white;
                    padding: 8px 16px;
                    border-radius: 20px;
                    font-size: 14px;
                    font-weight: 500;
                    z-index: 1000;
                    opacity: 0;
                    transition: opacity 0.3s ease;
                `;
                
                document.body.appendChild(indicator);
                
                // 显示动画
                setTimeout(() => {
                    indicator.style.opacity = '1';
                }, 10);
                
                // 自动移除
                setTimeout(() => {
                    indicator.style.opacity = '0';
                    setTimeout(() => {
                        if (indicator.parentNode) {
                            indicator.parentNode.removeChild(indicator);
                        }
                    }, 300);
                }, 2000);
            }
            
            randomizeExpression() {
                const expressions = ['happy', 'sad', 'surprised', 'angry', 'neutral'];
                const randomExpression = expressions[Math.floor(Math.random() * expressions.length)];
                this.setExpression(randomExpression);
                
                // 添加随机颜色效果
                this.faceElement.style.animation = 'color-shift 1s ease';
                setTimeout(() => {
                    this.faceElement.style.animation = 'none';
                }, 1000);
            }
            
            // 键盘控制设置
            setupKeyboardControls() {
                document.addEventListener('keydown', (e) => {
                    switch (e.key) {
                        case '1': this.setExpression('neutral'); break;
                        case '2': this.setExpression('happy'); break;
                        case '3': this.setExpression('surprised'); break;
                        case '4': this.setExpression('sad'); break;
                        case '5': this.setExpression('laugh'); break;
                        case '6': this.applyIrisTheme('blue'); break;
                        case '7': this.applyIrisTheme('green'); break;
                        case '8': this.applyIrisTheme('brown'); break;
                        case '9': this.applyIrisTheme('gray'); break;
                        case ' ': 
                            e.preventDefault();
                            this.randomExpression();
                            break;
                    }
                });
            }
        }
        
        // 初始化表情管理器
        document.addEventListener('DOMContentLoaded', () => {
            new EmotionManager();
        });
    </script>
</body>
</html>